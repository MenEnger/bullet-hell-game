# 弾幕ゲーム (Bullet Hell Game)

TypeScript + Vite + Canvas APIで実装された2D弾幕シューティングゲーム

## ゲーム概要

プレイヤーは敵が発射する弾幕を避けながら、すべての敵を倒すことを目指します。敵は全方向に弾を撃ち、プレイヤーは追尾弾で迎撃します。時間経過とともに弾幕が激しくなります。

## ゲームルール

- **目的**: 3体の敵をすべて倒す
- **勝利条件**: すべての敵を倒す
- **敗北条件**: ライフが0になる（5回被弾）
- **初期ライフ**: 5
- **得点**:
  - 敵を1体倒すごとに100点
  - クリアボーナス: 残機 × 100点

## 操作方法

- **W/A/S/D**: プレイヤーの移動
  - W: 上
  - A: 左
  - S: 下
  - D: 右
- **M**: 弾を発射（最も近い敵に向かう追尾弾）
- **ポーズボタン**: ゲームの一時停止/再開
- **リスタートボタン**: ゲームの再開（ゲームオーバー/クリア時）

## ゲームの特徴

### プレイヤーの弾
- 追尾弾: 最も近い敵を自動的に追いかける
- 発射クールダウン: 500ms
- 敵の弾と相殺可能

### 敵の挙動
- 3体の敵が上部エリアに配置
- 2秒ごとにランダムな位置またはプレイヤーの近くに移動
- 初期: 1秒ごとに全方向（8方向）に弾幕を発射
- **10秒経過後**: 弾丸発射レートが2倍（0.5秒間隔）に上昇

### 弾幕パターン
- 敵は中心から8方向に均等に弾を発射
- 弾は一定速度で直進

### ハイスコア
- 上位3位までのスコアをローカルストレージに保存
- ゲーム終了時に自動的に記録

## 技術スタック

- **言語**: TypeScript
- **ビルドツール**: Vite
- **レンダリング**: Canvas API
- **スタイル**: CSS

## セットアップ

### 必要要件
- Node.js 24以上
- npm

### インストール

```bash
npm install
```

### 開発サーバーの起動

```bash
# fnmを使用している場合
eval "$(fnm env)" && npm run dev

# 通常の場合
npm run dev
```

ブラウザで `http://localhost:5173/` を開いてゲームをプレイできます。

### ビルド

```bash
npm run build
```

### プレビュー

```bash
npm run preview
```

## プロジェクト構成

```
src/
├── main.ts          # エントリーポイント
├── game.ts          # ゲームのメインロジック
├── config.ts        # ゲーム設定
├── types.ts         # TypeScript型定義
├── utils.ts         # ユーティリティ関数
├── storage.ts       # ローカルストレージ管理
└── style.css        # スタイルシート
```

## ゲーム設定

`src/config.ts` でゲームの各種パラメータを調整できます:

- **canvasWidth**: 800px
- **canvasHeight**: 600px
- **playerSpeed**: 5
- **playerShootCooldown**: 500ms
- **playerBulletSpeed**: 12
- **playerLives**: 5
- **enemyCount**: 3
- **enemySpeed**: 2
- **enemyShootInterval**: 1000ms
- **enemyBulletSpeed**: 4
- **enemyBulletDirections**: 8方向
- **scorePerEnemy**: 100点

## ゲーム画面

- **左ペイン**: ゲームキャンバス（800x600px）
  - 左上に残機数表示
  - 左上に経過時間表示（秒単位）
- **右ペイン**:
  - 現在のスコア表示
  - ハイスコアトップ3表示
  - ポーズボタン

## カラースキーム

- プレイヤー: シアン (`#00d4ff`)
- 敵: 赤 (`#ff4444`)
- プレイヤーの弾: 黄色 (`#ffff00`)
- 敵の弾: オレンジ (`#ff8800`)
- 背景: ダークグレー (`#0f1419`)

## 主要なクラスとファイル

### Game クラス (`src/game.ts`)

ゲームのメインロジックを管理:
- プレイヤー、敵、弾丸の更新
- 衝突判定
- ゲーム状態管理（プレイ中、ポーズ、ゲームオーバー、クリア）
- Canvas描画
- 時間経過による難易度上昇

### 型定義 (`src/types.ts`)

主要な型:
- `Player`: プレイヤーの状態（位置、速度、残機など）
- `Enemy`: 敵機の状態（位置、速度、ターゲットなど）
- `Bullet`: 弾丸の状態（位置、速度、ホーミング対象など）
- `GameState`: ゲーム状態（'playing' | 'paused' | 'gameOver' | 'gameClear'）
- `GameConfig`: ゲーム設定値

### ユーティリティ (`src/utils.ts`)

汎用関数:
- `distance()`: 2点間の距離計算
- `normalize()`: ベクトル正規化
- `checkCollision()`: 円形衝突判定
- `clamp()`: 値の範囲制限
- `getDirectionVector()`: 方向ベクトル計算

### ストレージ (`src/storage.ts`)

ハイスコア管理（localStorage使用）:
- `getHighScores()`: ハイスコア取得
- `saveHighScore()`: ハイスコア保存（トップ3を自動管理）
- `updateHighScoresDisplay()`: UI更新

## ゲームループ

1. プレイヤー入力処理（WASD移動、M射撃）
2. プレイヤー位置更新
3. 敵機の移動とAI（ランダム移動 + プレイヤー追尾）
4. 敵機の射撃（時間経過により発射レート変化）
5. 弾丸の移動（プレイヤー弾はホーミング）
6. 衝突判定（敵vs弾、プレイヤーvs弾、弾vs弾）
7. Canvas描画
8. 次フレームへ（requestAnimationFrame）

## カスタマイズ例

### 敵機数を増やす

```typescript
// src/config.ts
enemyCount: 5,  // 3 → 5に変更
```

### 難易度上昇タイミングを変更

```typescript
// src/game.ts の updateEnemies() メソッド内
const shootInterval = elapsedTime >= 15000  // 10000 → 15000 (15秒に変更)
  ? CONFIG.enemyShootInterval / 2
  : CONFIG.enemyShootInterval;
```

### 弾の発射方向を増やす

```typescript
// src/config.ts
enemyBulletDirections: 16,  // 8 → 16に変更（16方向弾幕）
```

### プレイヤーの弾速を上げる

```typescript
// src/config.ts
playerBulletSpeed: 20,  // 12 → 20に変更
```

## 実装の特徴

### ホーミング弾の実装
プレイヤーの弾は毎フレーム最も近い敵への方向ベクトルを再計算し、自動追尾します（`src/game.ts:217-222`）。

### 弾丸相殺システム
プレイヤーの弾と敵の弾が衝突すると、両方とも消滅します（`src/game.ts:267-278`）。これにより、防御的なプレイが可能になります。

### 時間経過による難易度変化
ゲーム開始から10秒後、敵の弾丸発射間隔が半分（1秒→0.5秒）になります（`src/game.ts:159-162`）。

### 敵のAI
敵機は2秒ごとに以下のいずれかを選択します（`src/game.ts:165-180`）:
- 50%の確率でランダムな位置へ移動
- 50%の確率でプレイヤー付近へ移動

## 既知の制限事項

- ポーズ中は経過時間が停止しません（ゲームロジックのみ停止）
- モバイルデバイスには未対応（キーボード操作のみ）
- サウンドエフェクトなし
- マルチプレイヤー非対応

## トラブルシューティング

### 開発サーバーが起動しない
- Node.js 24以上がインストールされているか確認
- `npm install` を実行して依存関係をインストール

### ゲームが表示されない
- ブラウザのコンソールでエラーを確認
- Canvas APIをサポートするモダンブラウザを使用

### ハイスコアが保存されない
- ブラウザのlocalStorageが有効か確認
- プライベートブラウジングモードでは保存されない場合があります

## 開発者向けメモ

- ゲーム状態は `Game` クラスの `state` プロパティで管理
- 時間関連の処理は `Date.now()` を使用
- 弾丸の衝突判定は円形ベースで実装（`utils.ts:checkCollision`）
- ハイスコアはブラウザのlocalStorageに永続化
- すべての座標とベクトル計算は `Vector2D` 型を使用

## ライセンス

ISC
